<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Meu Controle Financeiro</title>
    <style>
        :root {
            --nu-roxo: #820ad1;
            --bg-color: #f5f5f5;
            --text-color: #111;
            --card-bg: #fff;
            --green: #03AC13;
            --red: #ff4d4d;
            --blue: #0099ff;
            --orange: #ff9900;
            --dark-gray: #555;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--nu-roxo);
            margin: 0;
            padding: 15px;
            color: var(--text-color);
            padding-bottom: 50px;
        }

        /* Cabe√ßalho */
        .header { text-align: center; margin-bottom: 20px; }
        .header select {
            background: rgba(255,255,255,0.2);
            border: none; color: white; padding: 10px 25px;
            border-radius: 20px; font-size: 1.2rem; font-weight: bold;
            cursor: pointer; appearance: none; -webkit-appearance: none;
            text-align: center;
        }
        .header select:focus { outline: none; background: rgba(255,255,255,0.3); }
        .header option { color: #333; background: white; }

        .dashboard { display: flex; flex-direction: column; gap: 15px; }

        /* Cart√µes */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        h2 {
            margin: 0 0 15px 0; font-size: 1rem; color: #666;
            text-transform: uppercase; letter-spacing: 1px;
            border-bottom: 1px solid #eee; padding-bottom: 5px;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* Inputs e Linhas */
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-size: 0.95rem; }
        .row label { font-weight: 500; color: #555; }
        
        .input-money {
            border: 1px solid #ddd; border-radius: 6px; padding: 8px;
            width: 130px; text-align: right; font-size: 1rem; color: #333;
            font-weight: 500;
        }
        .input-money:focus { border-color: var(--nu-roxo); outline: none; background-color: #fcfcfc; }

        .calc-value { font-weight: bold; font-size: 1.1rem; }
        .text-green { color: var(--green); }
        .text-red { color: var(--red); }
        .text-blue { color: var(--blue); }
        .text-orange { color: var(--orange); }
        .text-gray { color: var(--dark-gray); }
        
        /* Destaque Saldo Real */
        .saldo-real-destaque {
            background-color: #fff8e1;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ffe082;
            margin-top: 5px;
            margin-bottom: 10px;
        }

        .fatura-destaque {
            background: #fdfdfd; border: 1px solid #eee; border-radius: 10px; padding: 10px; margin-bottom: 15px;
        }

        .titulo-row {
            display: flex; justify-content: space-between; align-items: flex-end;
            margin: 20px 0 5px 0; border-bottom: 1px dashed #eee; padding-bottom: 2px;
        }
        .grupo-titulo { font-size: 0.75rem; font-weight: bold; color: #aaa; margin: 0; }
        .grupo-total { font-size: 0.9rem; font-weight: bold; color: #555; }

        .fatura-list { list-style: none; padding: 0; margin: 0; }
        .fatura-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
        
        .item-nome { border: none; width: 45%; font-size: 0.9rem; font-weight: 500; background: transparent;}
        .item-valor { border: none; width: 40%; text-align: right; font-size: 0.9rem; color: #555; background: transparent;}
        
        .val-negativo { color: var(--red); } 
        .val-positivo { color: var(--blue); }
        .val-pix { color: var(--orange); }
        .val-futuro { color: var(--dark-gray); }

        .btn-remove { background: none; border: none; color: #ccc; font-size: 1.2rem; padding: 0 5px; cursor: pointer;}
        .btn-remove:hover { color: var(--red); }

        .add-area { display: flex; gap: 5px; margin-top: 10px; }
        .add-area input { padding: 8px; border: 1px solid #ddd; border-radius: 6px; flex: 1; width: 100%; font-size: 0.9rem;}
        .btn-add { border: none; border-radius: 6px; padding: 0 12px; font-weight: bold; font-size: 1.2rem; cursor: pointer; color: white;}
        .bg-roxo { background-color: var(--nu-roxo); }
        .bg-blue { background-color: var(--blue); }
        .bg-orange { background-color: var(--orange); }
        .bg-gray { background-color: var(--dark-gray); }

        .big-result { text-align: center; padding: 20px; }
        .big-result span { display: block; font-size: 0.9rem; color: #777; margin-bottom: 5px; }
        .big-result strong { display: block; font-size: 2.2rem; color: var(--nu-roxo); }
        
        .resumo-fatura {
            background: #f8f8f8; padding: 10px; border-radius: 8px; margin-top: 15px; font-size: 0.9rem;
        }
        .linha-resumo { display: flex; justify-content: space-between; margin-bottom: 5px; color: #666; }
        .linha-final { display: flex; justify-content: space-between; margin-top: 8px; padding-top: 8px; border-top: 1px solid #ddd; font-weight: bold; font-size: 1rem; color: #333; }

    </style>
</head>
<body>

    <div class="header">
        <select id="mes-select" onchange="trocarMes()">
            <option value="Janeiro">Janeiro</option>
            <option value="Fevereiro" selected>Fevereiro</option>
            <option value="Mar√ßo">Mar√ßo</option>
            <option value="Abril">Abril</option>
            <option value="Maio">Maio</option>
            <option value="Junho">Junho</option>
            <option value="Julho">Julho</option>
            <option value="Agosto">Agosto</option>
            <option value="Setembro">Setembro</option>
            <option value="Outubro">Outubro</option>
            <option value="Novembro">Novembro</option>
            <option value="Dezembro">Dezembro</option>
        </select>
    </div>

    <div class="dashboard">

        <div class="card">
            <h2>üí∞ Minha Conta</h2>
            
            <div class="row">
                <label>Saldo Inicial (Do M√™s)</label>
                <input type="tel" id="saldo-nu" class="input-money" oninput="mascaraMoeda(this)" placeholder="R$ 0,00">
            </div>

            <div class="saldo-real-destaque">
                <div class="row" style="margin-bottom: 0;">
                    <label style="color: #f57f17;">Saldo no App Agora:</label>
                    <div class="calc-value text-orange" id="res-saldo-app">R$ 0,00</div>
                </div>
                <small style="color: #f9a825; font-size: 0.75rem;">(Saldo Inicial - Gastos Pix J√° Feitos)</small>
            </div>

            <div class="row">
                <label>Sal√°rio (+)</label>
                <input type="tel" id="salario" class="input-money" oninput="mascaraMoeda(this)" placeholder="R$ 0,00">
            </div>
        </div>

        <div class="card">
            <h2>
                üí∏ Gastos Pix / D√©bito (J√° fiz)
                <span class="text-orange" id="res-total-pix" style="font-size: 1rem;">R$ 0,00</span>
            </h2>
            <p style="font-size: 0.8rem; color: #999; margin-top: -10px; margin-bottom: 15px;">
                Adicione aqui o que J√Å saiu da conta (Sabonete, etc).
            </p>

            <ul class="fatura-list" id="lista-pix"></ul>
            
            <div class="add-area">
                <input type="text" id="novo-pix-nome" placeholder="Gasto (ex: Sabonete)">
                <input type="tel" id="novo-pix-valor" oninput="mascaraMoeda(this)" placeholder="R$ 0,00">
                <button class="btn-add bg-orange" onclick="adicionarItem('pix')">+</button>
            </div>
        </div>

        <div class="card">
            <h2>üí≥ Cart√£o de Cr√©dito</h2>
            
            <div class="fatura-destaque">
                <div class="row" style="margin-bottom:0">
                    <label style="color:var(--nu-roxo); font-weight:bold;">Fatura Atual (App)</label>
                    <input type="tel" id="fatura-app" class="input-money" oninput="mascaraMoeda(this)" placeholder="R$ 0,00" style="border-color:var(--nu-roxo)">
                </div>
            </div>

            <div class="titulo-row">
                <span class="grupo-titulo">üìå FIXOS (CART√ÉO)</span>
                <span class="grupo-total" id="display-total-fixos">R$ 0,00</span>
            </div>
            <ul class="fatura-list" id="lista-fixos"></ul>

            <div class="titulo-row">
                <span class="grupo-titulo">üõí EXTRAS (CART√ÉO)</span>
                <span class="grupo-total" id="display-total-extras">R$ 0,00</span>
            </div>
            <ul class="fatura-list" id="lista-extras"></ul>
            <div class="add-area">
                <input type="text" id="novo-extra-nome" placeholder="Compra no Cr√©dito">
                <input type="tel" id="novo-extra-valor" oninput="mascaraMoeda(this)" placeholder="R$ 0,00">
                <button class="btn-add bg-roxo" onclick="adicionarItem('extras')">+</button>
            </div>

            <div class="titulo-row">
                <span class="grupo-titulo" style="color: var(--blue);">üë• REEMBOLSOS / TERCEIROS</span>
                <span class="grupo-total" id="display-total-terceiros" style="color: var(--blue);">R$ 0,00</span>
            </div>
            <ul class="fatura-list" id="lista-terceiros"></ul>
            <div class="add-area">
                <input type="text" id="novo-terceiro-nome" placeholder="Quem? (ex: M√£e)">
                <input type="tel" id="novo-terceiro-valor" oninput="mascaraMoeda(this)" placeholder="R$ 0,00">
                <button class="btn-add bg-blue" onclick="adicionarItem('terceiros')">+</button>
            </div>

            <div class="resumo-fatura">
                <div class="linha-resumo">
                    <span>Fatura Bruta:</span>
                    <span id="res-fatura-bruta">R$ 0,00</span>
                </div>
                <div class="linha-resumo" style="color: var(--blue);">
                    <span>(-) Devem pra mim:</span>
                    <span id="res-total-terceiros">R$ 0,00</span>
                </div>
                <div class="linha-final">
                    <span>= MINHA PARTE CART√ÉO:</span>
                    <span id="res-minha-fatura" class="text-red">R$ 0,00</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>
                üìâ Abater do Final (Planejado)
                <span class="text-gray" id="res-total-futuros" style="font-size: 1rem;">R$ 0,00</span>
            </h2>
            <p style="font-size: 0.8rem; color: #999; margin-top: -10px; margin-bottom: 15px;">
                Gastos que <strong>ainda n√£o fiz</strong>, mas que j√° tem dono.
            </p>

            <ul class="fatura-list" id="lista-futuros"></ul>
            
            <div class="add-area">
                <input type="text" id="novo-futuro-nome" placeholder="Ex: Pe√ßas Carro">
                <input type="tel" id="novo-futuro-valor" oninput="mascaraMoeda(this)" placeholder="R$ 0,00">
                <button class="btn-add bg-gray" onclick="adicionarItem('futuros')">+</button>
            </div>
        </div>

        <div class="card big-result">
            <span>SOBROU PRO M√äS</span>
            <strong id="res-pro-mes">R$ 0,00</strong>
            <small style="color:#999; font-size:0.8rem; display:block; margin-top:10px;">
                (Saldo + Sal√°rio - Cart√£o - Pix - Planejados)
            </small>
        </div>

    </div>

    <script>
        const FIXOS_PADRAO = [
            { nome: "Tim", valor: 40.00 },
            { nome: "Corte Cabelo", valor: 60.00 },
            { nome: "Spotify", valor: 12.90 },
            { nome: "Paramount", valor: 27.90 },
            { nome: "Academia", valor: 159.90 },
            { nome: "PS Plus", valor: 65.00 }
        ];

        const ORDEM_MESES = [
            "Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho",
            "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"
        ];

        let dadosGerais = {}; 
        let mesAtual = "Fevereiro";
        let estado = {}; 

        function init() {
            const salvo = localStorage.getItem('financasV15'); // Atualizado V15
            if (salvo) {
                dadosGerais = JSON.parse(salvo);
            }
            mesAtual = document.getElementById('mes-select').value;
            carregarMes(mesAtual);
        }

        function mascaraMoeda(elemento) {
            let valor = elemento.value.replace(/\D/g, ""); 
            if (valor === "") {
                elemento.value = "";
                calcular();
                return;
            }
            valor = (parseFloat(valor) / 100).toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });
            elemento.value = valor;
            calcular();
        }

        function lerMoeda(valorString) {
            if (!valorString || typeof valorString !== 'string') return 0;
            let limpo = valorString.replace('R$', '').replace(/\./g, '').replace(',', '.').trim();
            return parseFloat(limpo) || 0;
        }

        function formatar(valorNum) {
            return valorNum.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        function trocarMes() {
            salvarEstadoNoGeral();
            mesAtual = document.getElementById('mes-select').value;
            carregarMes(mesAtual);
        }

        function carregarMes(mes) {
            if (dadosGerais[mes]) {
                estado = dadosGerais[mes];
            } else {
                // L√≥gica de heran√ßa de saldo
                let saldoInicialCalculado = 0;
                
                const indexMes = ORDEM_MESES.indexOf(mes);
                if (indexMes > 0) {
                    const nomeMesAnterior = ORDEM_MESES[indexMes - 1];
                    saldoInicialCalculado = calcularSobraDoMes(dadosGerais[nomeMesAnterior]);
                }

                estado = {
                    saldoNu: saldoInicialCalculado > 0 ? saldoInicialCalculado : 0,
                    salario: 0,
                    faturaApp: 0,
                    fixos: JSON.parse(JSON.stringify(FIXOS_PADRAO)),
                    extras: [],
                    terceiros: [],
                    pix: [],
                    futuros: []
                };
            }

            // Preenche campos
            document.getElementById('saldo-nu').value = estado.saldoNu > 0 ? formatar(estado.saldoNu) : '';
            document.getElementById('salario').value = estado.salario > 0 ? formatar(estado.salario) : '';
            document.getElementById('fatura-app').value = estado.faturaApp > 0 ? formatar(estado.faturaApp) : '';

            renderizarListas();
            calcular(); // Calcula o atual
        }

        function salvarEstadoNoGeral() {
            dadosGerais[mesAtual] = estado;
            localStorage.setItem('financasV15', JSON.stringify(dadosGerais));
        }

        // Fun√ß√£o auxiliar para calcular a sobra de qualquer m√™s (usada na propaga√ß√£o)
        function calcularSobraDoMes(dadosMes) {
            if (!dadosMes) return 0;
            
            const totalFixos = dadosMes.fixos.reduce((acc, i) => acc + (parseFloat(i.valor)||0), 0);
            const totalExtras = dadosMes.extras.reduce((acc, i) => acc + (parseFloat(i.valor)||0), 0);
            const totalTerceiros = dadosMes.terceiros.reduce((acc, i) => acc + (parseFloat(i.valor)||0), 0);
            const totalPix = dadosMes.pix.reduce((acc, i) => acc + (parseFloat(i.valor)||0), 0);
            const totalFuturos = dadosMes.futuros ? dadosMes.futuros.reduce((acc, i) => acc + (parseFloat(i.valor)||0), 0) : 0;

            const faturaBruta = dadosMes.faturaApp + totalFixos + totalExtras;
            const minhaParteFatura = faturaBruta - totalTerceiros;
            const somaEntradas = dadosMes.saldoNu + dadosMes.salario;

            return somaEntradas - minhaParteFatura - totalPix - totalFuturos;
        }

        // NOVA FUN√á√ÉO: Propaga o saldo para o futuro
        function propagarSaldos() {
            const indexAtual = ORDEM_MESES.indexOf(mesAtual);
            
            // Percorre todos os meses seguintes at√© Dezembro
            for (let i = indexAtual + 1; i < ORDEM_MESES.length; i++) {
                const mesAnterior = ORDEM_MESES[i-1];
                const mesSeguinte = ORDEM_MESES[i];

                // S√≥ propaga se o m√™s seguinte j√° foi criado/visitado
                if (dadosGerais[mesSeguinte] && dadosGerais[mesAnterior]) {
                    const sobraAnterior = calcularSobraDoMes(dadosGerais[mesAnterior]);
                    
                    // Atualiza o saldo inicial do m√™s seguinte
                    dadosGerais[mesSeguinte].saldoNu = sobraAnterior > 0 ? sobraAnterior : 0;
                } else {
                    // Se encontrou um buraco (m√™s n√£o criado), para a propaga√ß√£o
                    break; 
                }
            }
            // Salva tudo no banco
            localStorage.setItem('financasV15', JSON.stringify(dadosGerais));
        }

        function renderizarListas() {
            renderListaGenerica('fixos', 'lista-fixos', 'val-negativo');
            renderListaGenerica('extras', 'lista-extras', 'val-negativo');
            renderListaGenerica('terceiros', 'lista-terceiros', 'val-positivo');
            renderListaGenerica('pix', 'lista-pix', 'val-pix');
            renderListaGenerica('futuros', 'lista-futuros', 'val-futuro');
        }

        function renderListaGenerica(arrayName, elementId, colorClass) {
            const lista = document.getElementById(elementId);
            lista.innerHTML = '';
            
            estado[arrayName].forEach((item, index) => {
                const btnRemove = arrayName !== 'fixos' ? `<button class="btn-remove" onclick="removerItem('${arrayName}', ${index})">√ó</button>` : '';
                
                lista.innerHTML += `
                    <li class="fatura-item">
                        <input type="text" class="item-nome" value="${item.nome}" onchange="editarItem('${arrayName}', ${index}, 'nome', this.value)">
                        <input type="tel" class="item-valor ${colorClass}" value="${formatar(item.valor)}" oninput="mascaraMoeda(this)" onblur="editarItem('${arrayName}', ${index}, 'valor', this.value)">
                        ${btnRemove}
                    </li>`;
            });
        }

        function calcular() {
            estado.saldoNu = lerMoeda(document.getElementById('saldo-nu').value);
            estado.salario = lerMoeda(document.getElementById('salario').value);
            estado.faturaApp = lerMoeda(document.getElementById('fatura-app').value);

            const totalFixos = somarLista('fixos');
            const totalExtras = somarLista('extras');
            const totalTerceiros = somarLista('terceiros');
            const totalPix = somarLista('pix');
            const totalFuturos = somarLista('futuros');

            const saldoNoAppAgora = estado.saldoNu - totalPix;

            const faturaBruta = estado.faturaApp + totalFixos + totalExtras;
            const minhaParteFatura = faturaBruta - totalTerceiros;

            const somaEntradas = estado.saldoNu + estado.salario;
            const proMes = somaEntradas - minhaParteFatura - totalPix - totalFuturos;

            document.getElementById('res-saldo-app').innerText = formatar(saldoNoAppAgora); 
            document.getElementById('res-fatura-bruta').innerText = formatar(faturaBruta);
            document.getElementById('res-total-terceiros').innerText = formatar(totalTerceiros);
            document.getElementById('res-minha-fatura').innerText = formatar(minhaParteFatura);
            document.getElementById('display-total-fixos').innerText = formatar(totalFixos);
            document.getElementById('display-total-extras').innerText = formatar(totalExtras);
            document.getElementById('display-total-terceiros').innerText = formatar(totalTerceiros);
            document.getElementById('res-total-pix').innerText = formatar(totalPix);
            document.getElementById('res-total-futuros').innerText = formatar(totalFuturos);

            const elProMes = document.getElementById('res-pro-mes');
            elProMes.innerText = formatar(proMes);
            elProMes.style.color = proMes >= 0 ? '#820ad1' : '#ff4d4d';

            salvarEstadoNoGeral(); // Salva o m√™s atual
            propagarSaldos(); // Dispara o efeito cascata para os pr√≥ximos
        }

        function somarLista(arrayName) {
            return estado[arrayName].reduce((acc, item) => acc + (parseFloat(item.valor)||0), 0);
        }

        function adicionarItem(tipo) {
            let idSuffix = tipo;
            if (tipo === 'extras') idSuffix = 'extra';
            if (tipo === 'terceiros') idSuffix = 'terceiro';
            if (tipo === 'pix') idSuffix = 'pix';
            if (tipo === 'futuros') idSuffix = 'futuro';

            const nomeInput = document.getElementById(`novo-${idSuffix}-nome`);
            const valorInput = document.getElementById(`novo-${idSuffix}-valor`);

            const nome = nomeInput.value || 'Item';
            const valor = lerMoeda(valorInput.value);

            if (!valor) return;

            estado[tipo].push({ nome, valor });
            
            nomeInput.value = '';
            valorInput.value = '';
            
            renderizarListas();
            calcular();
        }

        function removerItem(lista, index) {
            estado[lista].splice(index, 1);
            renderizarListas();
            calcular();
        }

        function editarItem(lista, index, campo, valor) {
            if (campo === 'valor') {
                valor = lerMoeda(valor);
            }
            estado[lista][index][campo] = valor;
            calcular();
        }

        init();
    </script>
</body>
</html>