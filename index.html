<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minhas Finan√ßas V11</title>
    <style>
        :root {
            --nu-roxo: #820ad1;
            --bg-color: #f5f5f5;
            --text-color: #111;
            --card-bg: #fff;
            --green: #03AC13;
            --red: #ff4d4d;
            --blue: #0099ff;
            --orange: #ff9900;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--nu-roxo);
            margin: 0;
            padding: 15px;
            color: var(--text-color);
            padding-bottom: 50px;
        }

        /* Cabe√ßalho */
        .header { text-align: center; margin-bottom: 20px; }
        .header select {
            background: rgba(255,255,255,0.2);
            border: none; color: white; padding: 10px 25px;
            border-radius: 20px; font-size: 1.2rem; font-weight: bold;
            cursor: pointer; appearance: none; -webkit-appearance: none;
            text-align: center;
        }
        .header select:focus { outline: none; background: rgba(255,255,255,0.3); }
        .header option { color: #333; background: white; }

        .dashboard { display: flex; flex-direction: column; gap: 15px; }

        /* Cart√µes */
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        h2 {
            margin: 0 0 15px 0; font-size: 1rem; color: #666;
            text-transform: uppercase; letter-spacing: 1px;
            border-bottom: 1px solid #eee; padding-bottom: 5px;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* Inputs e Linhas */
        .row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-size: 0.95rem; }
        .row label { font-weight: 500; color: #555; }
        
        /* MUDAN√áA: Input agora parece texto mas aceita numeros */
        .input-money {
            border: 1px solid #ddd; border-radius: 6px; padding: 8px;
            width: 130px; text-align: right; font-size: 1rem; color: #333;
            font-weight: 500;
        }
        .input-money:focus { border-color: var(--nu-roxo); outline: none; background-color: #fcfcfc; }

        .calc-value { font-weight: bold; font-size: 1.1rem; }
        .text-green { color: var(--green); }
        .text-red { color: var(--red); }
        .text-blue { color: var(--blue); }
        .text-orange { color: var(--orange); }
        
        .fatura-destaque {
            background: #fdfdfd; border: 1px solid #eee; border-radius: 10px; padding: 10px; margin-bottom: 15px;
        }

        .titulo-row {
            display: flex; justify-content: space-between; align-items: flex-end;
            margin: 20px 0 5px 0; border-bottom: 1px dashed #eee; padding-bottom: 2px;
        }
        .grupo-titulo { font-size: 0.75rem; font-weight: bold; color: #aaa; margin: 0; }
        .grupo-total { font-size: 0.9rem; font-weight: bold; color: #555; }

        .fatura-list { list-style: none; padding: 0; margin: 0; }
        .fatura-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; }
        
        .item-nome { border: none; width: 45%; font-size: 0.9rem; font-weight: 500; background: transparent;}
        .item-valor { border: none; width: 40%; text-align: right; font-size: 0.9rem; color: #555; background: transparent;}
        
        .val-negativo { color: var(--red); } 
        .val-positivo { color: var(--blue); }
        .val-pix { color: var(--orange); }

        .btn-remove { background: none; border: none; color: #ccc; font-size: 1.2rem; padding: 0 5px; cursor: pointer;}
        .btn-remove:hover { color: var(--red); }

        .add-area { display: flex; gap: 5px; margin-top: 10px; }
        .add-area input { padding: 8px; border: 1px solid #ddd; border-radius: 6px; flex: 1; width: 100%; font-size: 0.9rem;}
        .btn-add { border: none; border-radius: 6px; padding: 0 12px; font-weight: bold; font-size: 1.2rem; cursor: pointer; color: white;}
        .bg-roxo { background-color: var(--nu-roxo); }
        .bg-blue { background-color: var(--blue); }
        .bg-orange { background-color: var(--orange); }

        .big-result { text-align: center; padding: 20px; }
        .big-result span { display: block; font-size: 0.9rem; color: #777; margin-bottom: 5px; }
        .big-result strong { display: block; font-size: 2.2rem; color: var(--nu-roxo); }
        
        .resumo-fatura {
            background: #f8f8f8; padding: 10px; border-radius: 8px; margin-top: 15px; font-size: 0.9rem;
        }
        .linha-resumo { display: flex; justify-content: space-between; margin-bottom: 5px; color: #666; }
        .linha-final { display: flex; justify-content: space-between; margin-top: 8px; padding-top: 8px; border-top: 1px solid #ddd; font-weight: bold; font-size: 1rem; color: #333; }

    </style>
</head>
<body>

    <div class="header">
        <select id="mes-select" onchange="trocarMes()">
            <option value="Janeiro">Janeiro</option>
            <option value="Fevereiro" selected>Fevereiro</option>
            <option value="Mar√ßo">Mar√ßo</option>
            <option value="Abril">Abril</option>
            <option value="Maio">Maio</option>
            <option value="Junho">Junho</option>
            <option value="Julho">Julho</option>
            <option value="Agosto">Agosto</option>
            <option value="Setembro">Setembro</option>
            <option value="Outubro">Outubro</option>
            <option value="Novembro">Novembro</option>
            <option value="Dezembro">Dezembro</option>
        </select>
    </div>

    <div class="dashboard">

        <div class="card">
            <h2>üí∞ Entradas</h2>
            <div class="row">
                <label>Saldo Conta Nubank</label>
                <input type="tel" id="saldo-nu" class="input-money" oninput="mascaraMoeda(this)" placeholder="R$ 0,00">
            </div>
            <div class="row">
                <label>Sal√°rio</label>
                <input type="tel" id="salario" class="input-money" oninput="mascaraMoeda(this)" placeholder="R$ 0,00">
            </div>
            <div class="row">
                <label>SOMA DISPON√çVEL</label>
                <div class="calc-value text-green" id="res-soma">R$ 0,00</div>
            </div>
        </div>

        <div class="card">
            <h2>üí≥ Gest√£o do Cart√£o</h2>
            
            <div class="fatura-destaque">
                <div class="row" style="margin-bottom:0">
                    <label style="color:var(--nu-roxo); font-weight:bold;">Fatura Atual (App)</label>
                    <input type="tel" id="fatura-app" class="input-money" oninput="mascaraMoeda(this)" placeholder="R$ 0,00" style="border-color:var(--nu-roxo)">
                </div>
            </div>

            <div class="titulo-row">
                <span class="grupo-titulo">üìå FIXOS (CART√ÉO)</span>
                <span class="grupo-total" id="display-total-fixos">R$ 0,00</span>
            </div>
            <ul class="fatura-list" id="lista-fixos"></ul>

            <div class="titulo-row">
                <span class="grupo-titulo">üõí EXTRAS (CART√ÉO)</span>
                <span class="grupo-total" id="display-total-extras">R$ 0,00</span>
            </div>
            <ul class="fatura-list" id="lista-extras"></ul>
            <div class="add-area">
                <input type="text" id="novo-extra-nome" placeholder="Compra no Cr√©dito">
                <input type="tel" id="novo-extra-valor" oninput="mascaraMoeda(this)" placeholder="R$ 0,00">
                <button class="btn-add bg-roxo" onclick="adicionarItem('extras')">+</button>
            </div>

            <div class="titulo-row">
                <span class="grupo-titulo" style="color: var(--blue);">üë• REEMBOLSOS / TERCEIROS</span>
                <span class="grupo-total" id="display-total-terceiros" style="color: var(--blue);">R$ 0,00</span>
            </div>
            <ul class="fatura-list" id="lista-terceiros"></ul>
            <div class="add-area">
                <input type="text" id="novo-terceiro-nome" placeholder="Quem? (ex: M√£e)">
                <input type="tel" id="novo-terceiro-valor" oninput="mascaraMoeda(this)" placeholder="R$ 0,00">
                <button class="btn-add bg-blue" onclick="adicionarItem('terceiros')">+</button>
            </div>

            <div class="resumo-fatura">
                <div class="linha-resumo">
                    <span>Fatura Bruta:</span>
                    <span id="res-fatura-bruta">R$ 0,00</span>
                </div>
                <div class="linha-resumo" style="color: var(--blue);">
                    <span>(-) Devem pra mim:</span>
                    <span id="res-total-terceiros">R$ 0,00</span>
                </div>
                <div class="linha-final">
                    <span>= MINHA PARTE CART√ÉO:</span>
                    <span id="res-minha-fatura" class="text-red">R$ 0,00</span>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>
                üí∏ Gastos no Pix / D√©bito
                <span class="text-orange" id="res-total-pix" style="font-size: 1rem;">R$ 0,00</span>
            </h2>
            <p style="font-size: 0.8rem; color: #999; margin-top: -10px; margin-bottom: 15px;">
                Descontados direto do "Sobrou".
            </p>

            <ul class="fatura-list" id="lista-pix"></ul>
            
            <div class="add-area">
                <input type="text" id="novo-pix-nome" placeholder="Ex: Mec√¢nico, Luz">
                <input type="tel" id="novo-pix-valor" oninput="mascaraMoeda(this)" placeholder="R$ 0,00">
                <button class="btn-add bg-orange" onclick="adicionarItem('pix')">+</button>
            </div>
        </div>

        <div class="card big-result">
            <span>SOBROU PRO M√äS</span>
            <strong id="res-pro-mes">R$ 0,00</strong>
            <small style="color:#999; font-size:0.8rem; display:block; margin-top:10px;">
                (Soma - Cart√£o - Pix)
            </small>
        </div>

    </div>

    <script>
        const FIXOS_PADRAO = [
            { nome: "Tim", valor: 40.00 },
            { nome: "Corte Cabelo", valor: 60.00 },
            { nome: "Spotify", valor: 12.90 },
            { nome: "Paramount", valor: 27.90 },
            { nome: "Academia", valor: 159.90 },
            { nome: "PS Plus", valor: 65.00 }
        ];

        let dadosGerais = {}; 
        let mesAtual = "Fevereiro";
        let estado = {}; 

        function init() {
            const salvo = localStorage.getItem('financasV11');
            if (salvo) {
                dadosGerais = JSON.parse(salvo);
            }

            mesAtual = document.getElementById('mes-select').value;
            carregarMes(mesAtual);
        }

        // --- FUN√á√ïES DE FORMATA√á√ÉO E M√ÅSCARA ---

        // Fun√ß√£o m√°gica que formata enquanto voc√™ digita
        function mascaraMoeda(elemento) {
            let valor = elemento.value.replace(/\D/g, ""); // Remove tudo que n√£o for d√≠gito
            
            if (valor === "") {
                elemento.value = "";
                calcular();
                return;
            }

            // Converte para centavos e formata
            valor = (parseFloat(valor) / 100).toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });

            elemento.value = valor;
            calcular(); // Recalcula em tempo real
        }

        // Fun√ß√£o que l√™ "R$ 1.200,50" e devolve o numero 1200.50 para conta
        function lerMoeda(valorString) {
            if (!valorString || typeof valorString !== 'string') return 0;
            // Remove 'R$', espa√ßos, pontos de milhar, e troca v√≠rgula por ponto
            let limpo = valorString.replace('R$', '').replace(/\./g, '').replace(',', '.').trim();
            return parseFloat(limpo) || 0;
        }

        // Fun√ß√£o que pega numero 1200.50 e devolve "R$ 1.200,50"
        function formatar(valorNum) {
            return valorNum.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }

        // ------------------------------------------

        function trocarMes() {
            salvarEstadoNoGeral();
            mesAtual = document.getElementById('mes-select').value;
            carregarMes(mesAtual);
        }

        function carregarMes(mes) {
            if (dadosGerais[mes]) {
                estado = dadosGerais[mes];
            } else {
                estado = {
                    saldoNu: 0,
                    salario: 0,
                    faturaApp: 0,
                    fixos: JSON.parse(JSON.stringify(FIXOS_PADRAO)),
                    extras: [],
                    terceiros: [],
                    pix: []
                };
            }

            // Preenche os inputs principais (agora com formata√ß√£o)
            document.getElementById('saldo-nu').value = estado.saldoNu > 0 ? formatar(estado.saldoNu) : '';
            document.getElementById('salario').value = estado.salario > 0 ? formatar(estado.salario) : '';
            document.getElementById('fatura-app').value = estado.faturaApp > 0 ? formatar(estado.faturaApp) : '';

            renderizarListas();
            calcular();
        }

        function salvarEstadoNoGeral() {
            dadosGerais[mesAtual] = estado;
            localStorage.setItem('financasV11', JSON.stringify(dadosGerais));
        }

        function renderizarListas() {
            renderListaGenerica('fixos', 'lista-fixos', 'val-negativo');
            renderListaGenerica('extras', 'lista-extras', 'val-negativo');
            renderListaGenerica('terceiros', 'lista-terceiros', 'val-positivo');
            renderListaGenerica('pix', 'lista-pix', 'val-pix');
        }

        function renderListaGenerica(arrayName, elementId, colorClass) {
            const lista = document.getElementById(elementId);
            lista.innerHTML = '';
            
            estado[arrayName].forEach((item, index) => {
                const btnRemove = arrayName !== 'fixos' ? `<button class="btn-remove" onclick="removerItem('${arrayName}', ${index})">√ó</button>` : '';
                
                lista.innerHTML += `
                    <li class="fatura-item">
                        <input type="text" class="item-nome" value="${item.nome}" onchange="editarItem('${arrayName}', ${index}, 'nome', this.value)">
                        <input type="tel" class="item-valor ${colorClass}" value="${formatar(item.valor)}" oninput="mascaraMoeda(this)" onblur="editarItem('${arrayName}', ${index}, 'valor', this.value)">
                        ${btnRemove}
                    </li>`;
            });
        }

        function calcular() {
            // Agora usamos lerMoeda para entender o que est√° escrito no input
            estado.saldoNu = lerMoeda(document.getElementById('saldo-nu').value);
            estado.salario = lerMoeda(document.getElementById('salario').value);
            estado.faturaApp = lerMoeda(document.getElementById('fatura-app').value);

            const totalFixos = somarLista('fixos');
            const totalExtras = somarLista('extras');
            const totalTerceiros = somarLista('terceiros');
            const totalPix = somarLista('pix');

            const faturaBruta = estado.faturaApp + totalFixos + totalExtras;
            const minhaParteFatura = faturaBruta - totalTerceiros;

            const somaEntradas = estado.saldoNu + estado.salario;
            const proMes = somaEntradas - minhaParteFatura - totalPix;

            // Resultados (apenas exibi√ß√£o)
            document.getElementById('res-soma').innerText = formatar(somaEntradas);
            document.getElementById('res-fatura-bruta').innerText = formatar(faturaBruta);
            document.getElementById('res-total-terceiros').innerText = formatar(totalTerceiros);
            document.getElementById('res-minha-fatura').innerText = formatar(minhaParteFatura);
            document.getElementById('display-total-fixos').innerText = formatar(totalFixos);
            document.getElementById('display-total-extras').innerText = formatar(totalExtras);
            document.getElementById('display-total-terceiros').innerText = formatar(totalTerceiros);
            document.getElementById('res-total-pix').innerText = formatar(totalPix);

            const elProMes = document.getElementById('res-pro-mes');
            elProMes.innerText = formatar(proMes);
            elProMes.style.color = proMes >= 0 ? '#820ad1' : '#ff4d4d';

            salvarEstadoNoGeral();
        }

        function somarLista(arrayName) {
            // Soma direto do estado (que guarda n√∫meros puros)
            return estado[arrayName].reduce((acc, item) => acc + (parseFloat(item.valor)||0), 0);
        }

        function adicionarItem(tipo) {
            let idSuffix = tipo;
            if (tipo === 'extras') idSuffix = 'extra';
            if (tipo === 'terceiros') idSuffix = 'terceiro';
            if (tipo === 'pix') idSuffix = 'pix';

            const nomeInput = document.getElementById(`novo-${idSuffix}-nome`);
            const valorInput = document.getElementById(`novo-${idSuffix}-valor`); // Input com R$

            const nome = nomeInput.value || 'Item';
            const valor = lerMoeda(valorInput.value); // Converte R$ para numero

            if (!valor) return;

            estado[tipo].push({ nome, valor });
            
            nomeInput.value = '';
            valorInput.value = '';
            
            renderizarListas();
            calcular();
        }

        function removerItem(lista, index) {
            estado[lista].splice(index, 1);
            renderizarListas();
            calcular();
        }

        function editarItem(lista, index, campo, valor) {
            // Se for valor, converte a string formatada de volta para n√∫mero
            if (campo === 'valor') {
                valor = lerMoeda(valor);
            }
            estado[lista][index][campo] = valor;
            calcular();
        }

        init();
    </script>
</body>
</html>